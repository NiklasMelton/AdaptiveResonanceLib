flowchart TB
  A([Start])
  A --> B[Raw data]
  B --> C[Normalize to 0..1]
  C --> D{Optional preprocessing?}
  D -- Yes --> E[Complement coding]
  D -- No --> F[Use normalized data]
  E --> G[For each sample/label pair]

  A --> ZD[Labels]
  ZD --> G

  F --> G
  G --> H{Any existing weights?}
  H -- No --> I[Create new weight from X]
  I --> ZA[Map cluster to class y]
  ZA --> N[Next sample]
  H -- Yes --> J[Compute activations for all weights]
  J --> K[Sort by activation descending]
  K --> L[Take next candidate weight]

  R{Candidates left?}
  R -- Yes --> L
  R -- No --> I

  L --> M{Match/Vigilance check passes?}
  M -- Yes --> ZB{Mapping for winning class matches the label y?}
  ZB -- Yes --> U[Update winning weight]
  ZB -- No --> ZC[Match Tracking]
  M -- No --> Q[Suppress candidate]
  ZC --> Q

  Q --> R
  U --> ZA




  N --> O{More samples?}
  O -- Yes --> G
  O -- No --> P([End])
