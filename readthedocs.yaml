# readthedocs.yaml
version: 2
build:
  os: ubuntu-22.04
  tools:
    python: "3.9"

  # Installing Poetry after the environment is created
  post_create_environment:
    - pip install poetry

  # Installing your dependencies using Poetry with the dev flag
  post_install:
    # VIRTUAL_ENV needs to be set manually as per the current workaround
    # https://github.com/readthedocs/readthedocs.org/pull/11152/
    - VIRTUAL_ENV=$READTHEDOCS_VIRTUALENV_PATH poetry install --with dev

# Build documentation using Sphinx
sphinx:
  configuration: docs/source/conf.py

python:
  # Installing project dependencies using Poetry, not pip
  install:
    - method: poetry
      path: .

# Commands that should run after dependencies are installed, in post_build
commands:
  post_build:
    - sphinx-build -b html docs/source/ $READTHEDOCS_OUTPUT/html
